<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DualLift-Scoreboard Prototype</title>
<style>
  body { font-family: Arial, sans-serif; line-height: 1.5; margin: 20px; background: #f9f9f9; }
  #app { max-width: 1200px; margin: auto; }
  header { text-align: center; margin-bottom: 1rem; }
  section { margin-bottom: 1.5rem; padding: 1rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px #ccc; }
  label { display: block; margin-top: 0.5rem; }
  input, select, button { margin-top: 0.25rem; padding: 0.4rem; width: 100%; max-width: 300px; }
  .flex-row { display: flex; gap: 1rem; }
  .half { flex: 1; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: center; }
  th { background-color: #eee; }
  .plate { width: 40px; height: 15px; margin: 0 2px; border-radius: 3px; display: inline-block; }
  .red { background: #d32f2f; }
  .blue { background: #1976d2; }
  .yellow { background: #fbc02d; }
  .green { background: #388e3c; }
  .white { background: #fafafa; border: 1px solid #999; }
  .gray { background: #666; }
  .decision-good { color: green; font-weight: bold; }
  .decision-no { color: red; font-weight: bold; }
  .decision-review { color: goldenrod; font-weight: bold; }
  #barbell-visual { margin-top: 1rem; height: 50px; display: flex; align-items: center; }
</style>
</head>
<body>
<div id="app">
  <header><h1>DualLift-Scoreboard Prototype</h1></header>

  <!-- Step 1: Event and Competition Setup -->
  <section id="event-setup">
    <h2>1. Setup Competition</h2>
    <label>
      Select Event Type:
      <select id="event-type">
        <option value="" disabled selected>Select event</option>
        <option value="olympic">Olympic Weightlifting</option>
        <option value="powerlifting">Powerlifting</option>
      </select>
    </label>
    <label>
      Competition Name:
      <input type="text" id="competition-name" placeholder="Enter competition name" />
    </label>
    <label>
      Enter Weight Categories (comma separated, e.g., 61,73,81):
      <input type="text" id="weight-categories" placeholder="e.g., 61,73,81" />
    </label>
    <button onclick="startRegistration()">Start Lifter Registration</button>
  </section>

  <!-- Step 2: Lifter Registration -->
  <section id="lifter-registration" style="display:none;">
    <h2>2. Register Lifters</h2>
    <form id="lifter-form">
      <label>Name:<input type="text" id="lifter-name" required /></label>
      <label>Team/College:<input type="text" id="lifter-team" /></label>
      <label>Bodyweight (kg):<input type="number" id="lifter-bodyweight" step="0.1" required /></label>
      <label>Date of Birth:<input type="date" id="lifter-dob" required /></label>
      <label>Category:
        <select id="lifter-category" required></select>
      </label>
      <label>Division:
        <select id="lifter-division" required>
          <option value="A">A</option>
          <option value="B">B</option>
        </select>
      </label>
      <label>First Lifts (comma separated):
        <input type="text" id="lifter-first-lifts" placeholder="e.g. 100,120 (adjust form dynamically later)" />
      </label>
      <button type="submit">Add Lifter</button>
    </form>
    <hr />
    <h3>Registered Lifters</h3>
    <table id="lifters-table">
      <thead>
        <tr><th>#</th><th>Name</th><th>Team</th><th>Bodyweight</th><th>DOB</th><th>Category</th><th>Division</th><th>First Lifts</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="startCompetition()">Start Competition</button>
  </section>

  <!-- Step 3: Competition Interface -->
  <section id="competition" style="display:none;">
    <h2>3. Competition Interface</h2>
    <div class="flex-row">
      <!-- Audience Display -->
      <div class="half" id="audience-display">
        <h3>Audience Display</h3>
        <div><strong>Current Lifter:</strong> <span id="current-lifter-name">---</span></div>
        <div><strong>Attempt Weight:</strong> <span id="current-attempt-weight">---</span> kg</div>
        <div><strong>Referee Decision:</strong> <span id="current-decision">Waiting</span></div>
        <div id="barbell-visual"></div>
      </div>

      <!-- Detailed Scoreboard -->
      <div class="half" id="scoreboard-display">
        <h3>Scoreboard</h3>
        <table id="scoreboard-table">
          <thead>
            <tr>
              <th>#</th><th>Name</th><th>DOB</th><th>Team</th><th>Division</th>
              <th>Attempt 1</th><th>Attempt 2</th><th>Attempt 3</th><th>Total</th><th>Rank</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Attempt Logging -->
    <fieldset>
      <legend>Log Attempt</legend>
      <label>Weight (kg): <input type="number" id="attempt-weight" step="0.5" /></label>
      <label>Status:
        <select id="attempt-status">
          <option value="good">Good Lift</option>
          <option value="no">No Lift</option>
          <option value="review">Under Review</option>
        </select>
      </label>
      <button onclick="logAttempt()">Submit Attempt</button>
    </fieldset>

    <!-- Timer -->
    <fieldset>
      <legend>Timer</legend>
      <label>Time (seconds):
        <input type="number" id="timer-length" value="60" min="10" max="180" />
      </label>
      <button onclick="startTimer()">Start</button>
      <button onclick="stopTimer()">Stop</button>
      <button onclick="resetTimer()">Reset</button>
      <div id="timer-display" style="font-size: 2rem; margin-top: 0.5rem;">60</div>
    </fieldset>
  </section>
</div>

<script>
  const lifters = [];
  let currentEvent = '';
  let currentCategories = [];
  let currentLifterIndex = 0;
  let attemptsPerLifter = {};
  let timerInterval;
  let timerRemaining = 0;

  function startRegistration() {
    const eventType = document.getElementById('event-type').value;
    const compName = document.getElementById('competition-name').value.trim();
    const categoriesInput = document.getElementById('weight-categories').value.trim();

    if (!eventType || !compName || !categoriesInput) {
      alert('Please fill all setup fields.');
      return;
    }
    currentEvent = eventType;
    currentCategories = categoriesInput.split(',').map(c => c.trim());

    // Populate lifter category select dynamically
    const categorySelect = document.getElementById('lifter-category');
    categorySelect.innerHTML = '';
    currentCategories.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat;
      option.textContent = cat + ' kg';
      categorySelect.appendChild(option);
    });

    document.getElementById('event-setup').style.display = 'none';
    document.getElementById('lifter-registration').style.display = 'block';
  }

  document.getElementById('lifter-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('lifter-name').value.trim();
    const team = document.getElementById('lifter-team').value.trim();
    const bodyweight = parseFloat(document.getElementById('lifter-bodyweight').value);
    const dob = document.getElementById('lifter-dob').value;
    const category = document.getElementById('lifter-category').value;
    const division = document.getElementById('lifter-division').value;
    const firstLiftsInput = document.getElementById('lifter-first-lifts').value.trim();
    const firstLifts = firstLiftsInput ? firstLiftsInput.split(',').map(x => parseFloat(x)) : [];

    lifters.push({name, team, bodyweight, dob, category, division, firstLifts});
    updateLiftersTable();
    this.reset();
  });

  function updateLiftersTable() {
    const tbody = document.querySelector('#lifters-table tbody');
    tbody.innerHTML = '';
    lifters.forEach((lifter, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${lifter.name}</td>
        <td>${lifter.team}</td>
        <td>${lifter.bodyweight.toFixed(1)}</td>
        <td>${lifter.dob}</td>
        <td>${lifter.category}</td>
        <td>${lifter.division}</td>
        <td>${lifter.firstLifts.join(', ')}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function startCompetition() {
    if (lifters.length === 0) {
      alert('Register at least one lifter.');
      return;
    }
    assignStartingNumbers();
    document.getElementById('lifter-registration').style.display = 'none';
    document.getElementById('competition').style.display = 'block';
    showCurrentLifter();
    updateScoreboard();
    resetTimer();
  }

  function assignStartingNumbers() {
    // Sort by sum of first lifts descending
    lifters.sort((a, b) => {
      const totalA = a.firstLifts.reduce((a,b) => a+b, 0);
      const totalB = b.firstLifts.reduce((a,b) => a+b, 0);
      return totalB - totalA;
    });
    lifters.forEach((lifter, i) => {
      lifter.startingNumber = i + 1;
      lifter.attempts = [null,null,null];
      lifter.total = 0;
      lifter.rank = null;
    });
    currentLifterIndex = 0;
  }

  function showCurrentLifter() {
    const lifter = lifters[currentLifterIndex];
    if (!lifter) return;
    document.getElementById('current-lifter-name').textContent = lifter.name;
    document.getElementById('current-attempt-weight').textContent = '0';
    document.getElementById('current-decision').textContent = 'Waiting';
    updateBarbellVisual(0);
  }

  function logAttempt() {
    const weightInput = document.getElementById('attempt-weight');
    const statusInput = document.getElementById('attempt-status');
    const weight = parseFloat(weightInput.value);
    const status = statusInput.value;
    if (isNaN(weight) || weight <= 0) {
      alert('Please enter a valid weight.');
      return;
    }
    const lifter = lifters[currentLifterIndex];
    if (!lifter) return;

    // Log attempt at first empty slot
    const attemptIndex = lifter.attempts.findIndex(a => a === null);
    if (attemptIndex === -1) {
      alert('All attempts logged for this lifter.');
      return;
    }
    lifter.attempts[attemptIndex] = {weight, status};
    lifter.total += (status === 'good' ? weight : 0);

    // Update UI
    updateScoreboard();
    updateBarbellVisual(weight);
    document.getElementById('current-attempt-weight').textContent = weight.toFixed(1);
    document.getElementById('current-decision').textContent = statusText(status);

    // Move to next lifter if all attempts done
    if (lifter.attempts.every(a => a !== null)) {
      if (currentLifterIndex < lifters.length - 1) {
        currentLifterIndex++;
        showCurrentLifter();
      } else {
        calculateRanks();
        alert('All attempts logged. Competition complete!');
      }
    }

    // Reset inputs for next attempt
    weightInput.value = '';
    statusInput.value = 'good';
    resetTimer();
  }

  function statusText(status) {
    if(status === 'good') return 'Good Lift';
    if(status === 'no') return 'No Lift';
    if(status === 'review') return 'Under Review';
    return '';
  }

  function updateScoreboard() {
    const tbody = document.querySelector('#scoreboard-table tbody');
    tbody.innerHTML = '';
    lifters.forEach((lifter, i) => {
      const tr = document.createElement('tr');
      const attemptsHtml = lifter.attempts.map(attempt => {
        if (!attempt) return '-';
        let cls = '';
        if (attempt.status === 'good') cls = 'decision-good';
        else if (attempt.status === 'no') cls = 'decision-no';
        else if (attempt.status === 'review') cls = 'decision-review';
        return `<span class="${cls}">${attempt.weight} kg</span>`;
      }).join('</td><td>');
      tr.innerHTML = `
        <td>${lifter.startingNumber}</td>
        <td>${lifter.name}</td>
        <td>${lifter.dob}</td>
        <td>${lifter.team}</td>
        <td>${lifter.division}</td>
        <td>${lifter.attempts[0] ? attemptsHtml.split('</td><td>')[0] : '-'}</td>
        <td>${lifter.attempts[1] ? attemptsHtml.split('</td><td>')[1] : '-'}</td>
        <td>${lifter.attempts[2] ? attemptsHtml.split('</td><td>')[2] : '-'}</td>
        <td>${lifter.total.toFixed(1)}</td>
        <td>${lifter.rank !== null ? lifter.rank : '-'}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function calculateRanks() {
    lifters.sort((a,b) => b.total - a.total);
    lifters.forEach((lifter,i) => {
      lifter.rank = i + 1;
    });
    updateScoreboard();
  }

  // Timer functions
  function startTimer() {
    const length = parseInt(document.getElementById('timer-length').value,10);
    timerRemaining = length;
    document.getElementById('timer-display').textContent = timerRemaining;
    stopTimer();
    timerInterval = setInterval(() => {
      timerRemaining--;
      document.getElementById('timer-display').textContent = timerRemaining;
      if(timerRemaining <= 0) stopTimer();
    },1000);
  }
  function stopTimer() {
    clearInterval(timerInterval);
  }
  function resetTimer() {
    stopTimer();
    const length = parseInt(document.getElementById('timer-length').value,10);
    timerRemaining = length;
    document.getElementById('timer-display').textContent = timerRemaining;
  }

  // Visual Barbell Display with plates (simplified)
  function updateBarbellVisual(weight) {
    const barbellDiv = document.getElementById('barbell-visual');
    barbellDiv.innerHTML = ''; // Clear

    if (weight < 20) {
      barbellDiv.textContent = 'No plates loaded (weight < barbell)';
      return;
    }

    const plates = calculatePlates(weight);
    // Show collar first
    const collar = document.createElement('span');
    collar.className = 'plate gray';
    collar.title = '2.5 kg Collar Lock';
    collar.textContent = 'Col';
    barbellDiv.appendChild(collar);

    plates.forEach(p => {
      const plate = document.createElement('span');
      plate.className = 'plate ' + p.color;
      plate.title = `${p.weight} kg plate`;
      plate.textContent = p.weight;
      barbellDiv.appendChild(plate);
    });
  }

  // Plate calculation - returns array of plates to be loaded on one sleeve
  function calculatePlates(totalWeight) {
    const barWeight = 20;
    const collarWeight = 5;
    let weightPerSide = (totalWeight - barWeight - collarWeight) / 2;
    if(weightPerSide <= 0) return [];

    // Plates in order from smallest to largest for convenience; will reverse for display
    const plateOptions = [
      {weight: 0.5, color: 'white'}, {weight: 1, color: 'green'}, {weight: 1.5, color: 'yellow'},
      {weight: 2, color: 'blue'}, {weight: 2.5, color: 'red'}, {weight: 5, color: 'white'},
      {weight: 10, color: 'green'}, {weight: 15, color: 'yellow'}, {weight: 20, color: 'blue'},
      {weight: 25, color: 'red'}
    ].sort((a,b) => b.weight - a.weight);

    const plates = [];
    plateOptions.forEach(p => {
      while(weightPerSide >= p.weight) {
        plates.push(p);
        weightPerSide -= p.weight;
        weightPerSide = Math.round(weightPerSide * 100) / 100; // avoid floating issues
      }
    });
    return plates.reverse(); // largest plate farthest from collar
  }
</script>
</body>
</html>
